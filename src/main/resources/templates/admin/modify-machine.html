<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editar Máquina - FabLab</title>
    <link rel="icon" th:href="@{/img/logo.png}" href="/img/logo.png" type="image/png" />
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" href="/css/bootstrap.min.css" />
    <link rel="stylesheet" th:href="@{/css/main.css}" href="/css/main.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <style>
      .img-preview {
        max-width: 260px;
        max-height: 180px;
        object-fit: cover;
      }
    </style>
    <script th:src="@{/js/admin/modify-machine.js}" src="/js/admin/modify-machine.js" defer></script>
    <script th:src="@{/js/file-validation.js}" src="/js/file-validation.js" defer></script>
  </head>
  <body>
    <div th:replace="~{fragments/header :: siteHeader('admin')}"></div>

    <div class="container mt-4">
      <!-- Hero Section -->
      <div class="admin-hero">
        <h1>Editar Máquina <span id="machineIdSpan" class="opacity-75"></span></h1>
        <p class="lead">Actualiza la información, estado y precios de la maquinaria</p>
      </div>

      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow-sm border-0" id="editForm">
            <div class="card-body p-4 p-md-5">
              
              <div id="adminGuard" class="alert alert-warning d-none mb-4">
                Solo administradores pueden editar máquinas.
              </div>

              <div class="mb-4 text-center">
                <label class="form-label d-block fw-bold">Imagen actual</label>
                <img
                  id="currentImage"
                  class="border rounded img-preview shadow-sm"
                  src="/img/logo.png"
                  alt="Imagen actual"
                />
                <div class="form-text mt-2">
                  Si subes una nueva, la anterior se reemplaza.
                </div>
              </div>

      <form
        id="machineForm"
        method="post"
        action="#"
        enctype="multipart/form-data"
        class="needs-validation"
        novalidate
      >
        <div class="mb-3">
          <label for="name" class="form-label">Nombre</label>
          <input type="text" class="form-control" id="name" name="name" />
          <div class="form-text">Déjalo vacío para mantener el actual.</div>
        </div>
        <div class="mb-3">
          <label for="location" class="form-label">Ubicación</label>
          <input
            type="text"
            class="form-control"
            id="location"
            name="location"
          />
          <div class="form-text">Déjalo vacío para mantener el actual.</div>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Descripción</label>
          <textarea
            class="form-control"
            id="description"
            name="description"
            rows="4"
            maxlength="300"
          ></textarea>
          <div class="form-text">
            Máximo 300 caracteres. Vacío para mantener la actual.
          </div>
        </div>
        <div class="mb-3">
          <label for="image" class="form-label">Nueva imagen (opcional)</label>
          <div class="input-group">
            <input
              type="file"
              class="form-control"
              id="image"
              name="image"
              accept="image/*"
            />
            <label class="input-group-text" for="image">Subir</label>
          </div>
          <div class="form-text">Formatos: JPG, PNG o GIF. Máx 2 MB.</div>
        </div>
        <div class="mb-3">
          <label for="hourlyPrice" class="form-label"
            >Precio por hora (€)</label
          >
          <div class="input-group">
            <span class="input-group-text">€</span>
            <input
              type="number"
              step="0.01"
              min="0"
              class="form-control"
              id="hourlyPrice"
              name="hourlyPrice"
              placeholder="0.00"
              aria-label="Precio por hora"
            />
            <span class="input-group-text">.00</span>
          </div>
          <div class="form-text">Vacío para mantener el actual.</div>
        </div>
        <div class="mb-3">
          <label for="status" class="form-label">Estado</label>
          <select class="form-select" id="status" name="status">
            <option value="">(Sin cambio)</option>
            <option value="Disponible">Disponible</option>
            <option value="En_mantenimiento">En mantenimiento</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Guardar cambios</button>
        <a href="/machines" class="btn btn-secondary ms-2">Cancelar</a>
      </form>
      <br />
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="text-center py-4 text-muted small">
      <div class="container">
        Proyecto académico — FabLab Mérida. Asignatura: MDAI 2025-26. UEx Mérida
      </div>
    </footer>
    <script th:src="@{/js/bootstrap.bundle.min.js}" src="/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
